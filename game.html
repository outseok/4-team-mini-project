<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="utf-8" />
    <title>틀린 그림 찾기</title>

    <style>
        #markup {
            position: relative;
            display: inline-block;
            line-height: 0;
        
        }

        .marker {
            position: absolute;
            width: 30px;
            height: 30px;
            border: 3px solid red;
            border-radius: 50%;
            pointer-events: none;
            transform: translate(-50%, -50%);
            z-index: 10;
            
        }
        img {
            display: block;
        }
    </style>
</head>

<body>
    <h1>
        찾은 개수:
        <input type="text" id="count" readonly style="width:60px;">
    </h1>
        
    <div id="markup">
        <img id="pic" src="../image/wrong.png" width="1200" height="600" alt="틀린그림">
    </div>

    <script>
        
        const BASE_W = 1200;
        const BASE_H = 600;

        const answers = [
            { x: 782, y: 97, name: 'cat', range: 40, found: false },
            { x: 870, y: 250, name: 'post', range: 50, found: false },
            { x: 965, y: 77, name: 'watch',range: 30, found: false },
            { x: 1100, y: 540, name: 'books',range: 40, found: false },
            { x: 820, y: 360, name: 'pot', range: 50, found: false }
        ];

        let found = 0;

        function count() {
            document.getElementById("count").value = found;
        }

        function pos(e, img) {
            const r = img.getBoundingClientRect();
            return {
                x: (e.clientX - r.left) * (BASE_W / r.width),
                y: (e.clientY - r.top) * (BASE_H / r.height)
            };
        }

        function mark(x, y, img) {
            const r = img.getBoundingClientRect();

            const px = x * (r.width / BASE_W);
            const py = y * (r.height / BASE_H);

            const m = document.createElement("span"); 
            m.className = "marker";
            m.style.left = px + "px";
            m.style.top = py + "px";
            document.getElementById("markup").appendChild(m);
        }

        function check(x, y, img) {
            for (let a of answers) {
                if (!a.found && Math.hypot(x - a.x, y - a.y) <= a.range) {
                    a.found = true;
                    found++;
                    finish();
                    count();
                    mark(a.x, a.y, img);
                    return;
                }
            }
        }

        window.clickcheck("load", () => {
            const img = document.getElementById("pic");
            count();

            img.clickcheck("click", (e) => {
                const p = pos(e, img);
                check(p.x, p.y, img);
            });
        });
        
        function finish() {
            if (found == 5) {
                alert("성공! 500포인트 획득!:");
            }
        }
    </script>
</body>

</html>